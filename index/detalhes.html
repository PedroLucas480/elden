<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes da Build - Elden Builds</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/detalhes.css">
</head>
<body>

    <main class="conteudo-detalhes">
        <div id="build-info">
            <h2 style="color: white; text-align: center;">Carregando detalhes da build...</h2>
        </div>
    </main>

    <script>
    async function carregarDetalhes() {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');
        const container = document.getElementById('build-info');

        if (!container || !id) {
            if (container) container.innerHTML = "<h2>Build não identificada.</h2>";
            return;
        }

        try {
            const URL_RAILWAY = "https://elden-production.up.railway.app"; 
            const apiBaseUrl = window.location.hostname === 'localhost' 
                ? 'http://localhost:3000' 
                : URL_RAILWAY;

            const response = await fetch(`${apiBaseUrl}/api/builds/${id}`);
            if (!response.ok) throw new Error('Build não encontrada');
            
            const build = await response.json();

            // --- LÓGICA DE VÍDEO (YOUTUBE + TIKTOK) ---
            let videoHtml = "";
            if (build.video_url) {
                if (build.video_url.includes('tiktok.com')) {
                    const tiktokId = build.video_url.split('/video/')[1]?.split('?')[0];
                    if (tiktokId) {
                        // ADICIONADO: Estilo inline para remover fundo branco do TikTok e centralizar
                        videoHtml = `<iframe src="https://www.tiktok.com/embed/v2/${tiktokId}" 
                                     style="width:100%; height:100%; background: transparent; display: block;" 
                                     frameborder="0" allowfullscreen></iframe>`;
                    }
                } else {
                    let videoId = "";
                    if (build.video_url.includes('shorts/')) {
                        videoId = build.video_url.split('shorts/')[1].split(/[?&]/)[0];
                    } else if (build.video_url.includes('v=')) {
                        videoId = build.video_url.split('v=')[1].split('&')[0];
                    } else if (build.video_url.includes('youtu.be/')) {
                        videoId = build.video_url.split('youtu.be/')[1].split(/[?&]/)[0];
                    }
                    if (videoId) {
                        videoHtml = `<iframe src="https://www.youtube.com/embed/${videoId.trim()}" frameborder="0" allowfullscreen></iframe>`;
                    }
                }
            }

            if (!videoHtml) {
                videoHtml = `<div style="padding: 40px; color: #d6b36a; text-align: center; display: flex; flex-direction: column; justify-content: center; height: 100%;">
                                <p>Vídeo de demonstração em breve...</p>
                                <small style="color: gray; margin-top: 10px;">Link: ${build.video_url || 'vazio'}</small>
                             </div>`;
            }

            // --- INJEÇÃO DO HTML ---
            container.innerHTML = `
                <div class="build-flex-container">
                    
                    <div class="build-texto">
                        <h1>${build.nome || 'Nome da Build'}</h1>
                        <p style="color: #ffffff; font-style: italic; opacity: 0.9;">${build.descricao || 'Sem descrição'}</p>
                        
                        <h3 style="margin-top:30px;">ESTATUTOS (STATS)</h3>
                        <div class="grid-stats">
                            <div class="stat-item">VIGOR: ${build.vigor || 0}</div>
                            <div class="stat-item">MENTE: ${build.mente || 0}</div>
                            <div class="stat-item">RESISTÊNCIA: ${build.resistencia || 0}</div>
                            <div class="stat-item">FORÇA: ${build.forca || 0}</div>
                            <div class="stat-item">DESTREZA: ${build.destreza || 0}</div>
                            <div class="stat-item">INTELIGÊNCIA: ${build.inteligencia || 0}</div>
                            <div class="stat-item">FÉ: ${build.fe || 0}</div>
                            <div class="stat-item">ARCANO: ${build.arcano || 0}</div>
                        </div>

                        <div class="equipamentos">
                            <h3>EQUIPAMENTOS E LOCALIZAÇÃO</h3>
                            <p><strong>Arma Principal:</strong> ${build.arma_principal || 'Não informada'}</p>
                            <p><strong>Classe Inicial Sugerida:</strong> ${build.classe_inicial || 'Qualquer uma'}</p>
                            <p><strong>Onde encontrar:</strong> ${build.localizacao_nome || 'Explorando o mapa'}</p>
                            ${build.localizacao_url ? `<a href="${build.localizacao_url}" target="_blank" style="color: #d6b36a; font-weight: bold;">[Abrir Mapa em Nova Aba]</a>` : ''}
                        </div>
                    </div>

                    <div class="coluna-midia-mapa">
                        <div class="build-video">
                            ${videoHtml}
                        </div>

                        <div class="build-mapa">
                             ${build.localizacao_url ? 
                                `<iframe src="${build.localizacao_url}" frameborder="0" allowfullscreen style="width:100%; height:100%; border:none;"></iframe>` :
                                `<div style="padding: 20px; color: #d6b36a; text-align: center; display: flex; align-items: center; height: 100%; justify-content: center;">
                                    <p>Mapa de localização disponível em breve...</p>
                                 </div>`
                             }
                        </div>
                    </div>

                </div>
                
                <div style="margin-top: 40px;">
                    <a href="Builds.html" class="btn-view">← Voltar para lista</a>
                </div>
            `;

        } catch (error) {
            console.error("Erro:", error);
            container.innerHTML = `<h2 style="color: #d6b36a;">Erro: ${error.message}</h2>
            <a href="Builds.html" class="btn-view">Voltar</a>`;
        }
    }

    window.addEventListener('DOMContentLoaded', carregarDetalhes);
    </script>
</body>
</html>