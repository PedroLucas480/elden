<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes da Build - Elden Builds</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/detalhes.css">
</head>
<body>
    

    <main class="conteudo-detalhes">
        <div id="build-info">
            <h2 style="color: white; text-align: center;">Carregando detalhes da build...</h2>
        </div>
    </main>

    <script>
    async function carregarDetalhes() {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');
        const container = document.getElementById('build-info');

        if (!container || !id) {
            if (container) container.innerHTML = "<h2>Build não identificada.</h2>";
            return;
        }

        try {
            const URL_RAILWAY = "https://elden-production.up.railway.app"; 
            const apiBaseUrl = window.location.hostname === 'localhost' 
                ? 'http://localhost:3000' 
                : URL_RAILWAY;

            const response = await fetch(`${apiBaseUrl}/api/builds/${id}`);
            if (!response.ok) throw new Error('Build não encontrada');
            
            const build = await response.json();

            // --- LÓGICA DE VÍDEO (REVISADA) ---
            let videoHtml = "";
            if (build.video_url) {
                const url = build.video_url.toLowerCase().trim();
                let urlFinal = build.video_url.trim();

                // 1. Vídeo Local (MP4)
                if (url.endsWith('.mp4')) {
                    // Ajusta o caminho para subir uma pasta (já que o html está em /index)
                    if (!url.startsWith('http') && !url.startsWith('../')) {
                        urlFinal = '../' + urlFinal;
                    }
                    videoHtml = `<video src="${urlFinal}" autoplay muted loop controls playsinline 
                                 style="width:100%; height:auto; max-height:800px; object-fit: contain; background: #000; display: block;">
                                 </video>`;
                } 
                // 2. TikTok
                else if (url.includes('tiktok.com')) {
                    const tiktokId = urlFinal.split('/video/')[1]?.split('?')[0];
                    videoHtml = `<iframe src="https://www.tiktok.com/embed/v2/${tiktokId}" 
                                 style="width:100%; aspect-ratio: 9/16; background: transparent;" 
                                 frameborder="0" allowfullscreen></iframe>`;
                } 
                // 3. YouTube
                else {
                    let videoId = "";
                    if (url.includes('shorts/')) {
                        videoId = urlFinal.split('shorts/')[1].split(/[?&]/)[0];
                    } else if (url.includes('v=')) {
                        videoId = urlFinal.split('v=')[1].split('&')[0];
                    } else if (url.includes('youtu.be/')) {
                        videoId = urlFinal.split('youtu.be/')[1].split(/[?&]/)[0];
                    }
                    
                    if (videoId) {
                        videoHtml = `<iframe src="https://www.youtube.com/embed/${videoId.trim()}" 
                                     style="width:100%; aspect-ratio: 16/9; border:none;" 
                                     frameborder="0" allowfullscreen></iframe>`;
                    }
                }
            }

            if (!videoHtml) {
                videoHtml = `<div style="padding: 40px; color: #d6b36a; text-align: center;">Vídeo em breve...</div>`;
            }

            // --- INJEÇÃO DO HTML ---
            container.innerHTML = `
                <div class="build-flex-container">
                    
                    <div class="build-texto">
                        <h1>${build.nome || 'Nome da Build'}</h1>
                        <p style="color: #ffffff; font-style: italic; opacity: 0.9;">${build.descricao || 'Sem descrição'}</p>
                        
                        <h3 style="margin-top:30px;">ESTATUTOS (STATS)</h3>
                        <div class="grid-stats">
                            <div class="stat-item">VIGOR: ${build.vigor || 0}</div>
                            <div class="stat-item">MENTE: ${build.mente || 0}</div>
                            <div class="stat-item">RESISTÊNCIA: ${build.resistencia || 0}</div>
                            <div class="stat-item">FORÇA: ${build.forca || 0}</div>
                            <div class="stat-item">DESTREZA: ${build.destreza || 0}</div>
                            <div class="stat-item">INTELIGÊNCIA: ${build.inteligencia || 0}</div>
                            <div class="stat-item">FÉ: ${build.fe || 0}</div>
                            <div class="stat-item">ARCANO: ${build.arcano || 0}</div>
                        </div>

                        <div class="equipamentos">
                            <h3>EQUIPAMENTOS E LOCALIZAÇÃO</h3>
                            <p><strong>Arma Principal:</strong> ${build.arma_principal || 'Não informada'}</p>
                            <p><strong>Classe Inicial Sugerida:</strong> ${build.classe_inicial || 'Qualquer uma'}</p>
                            <p><strong>Onde encontrar:</strong> ${build.localizacao_nome || 'Explorando o mapa'}</p>
                        </div>

                        <div class="secao-itens-detalhada" style="margin-top: 40px;">
                            <h2 style="border-bottom: 1px solid #d6b36a; padding-bottom: 10px;">Weapons</h2>
                            <ul style="list-style: none; padding: 0;">
                                <li style="margin-bottom: 20px;">
                                    <strong style="color: #ff4d4d; font-size: 1.2rem;">• Greatsword (Colossal)</strong>
                                    <p style="color: #ccc; margin-left: 20px;">Esta arma servirá a esta build com seu alto escalonamento de força.</p>
                                </li>
                            </ul>

                            <h2 style="border-bottom: 1px solid #d6b36a; padding-bottom: 10px; margin-top: 30px;">Talismans</h2>
                            <ul style="list-style: none; padding: 0;">
                                <li style="margin-bottom: 20px;">
                                    <strong style="color: #ff4d4d; font-size: 1.2rem;">• Shard of Alexander</strong>
                                    <p style="color: #ccc; margin-left: 20px;">Aumenta drasticamente o dano de ataque das habilidades de arma.</p>
                                </li>
                            </ul>
                        </div>
                        
                        <div style="margin-top: 40px;">
                            <a href="Builds.html" class="btn-view">← Voltar para lista</a>
                        </div>
                    </div>

                    <div class="coluna-midia-mapa">
                        <div class="build-video" style="height: auto; min-height: unset;">
                            ${videoHtml}
                        </div>

                        <div class="build-mapa">
                             ${build.localizacao_url ? 
                                `<iframe src="${build.localizacao_url}" frameborder="0" allowfullscreen style="width:100%; height:100%; border:none;"></iframe>` :
                                `<div style="padding: 20px; color: #d6b36a; text-align: center;">Mapa em breve...</div>`
                             }
                        </div>
                    </div>

                </div>
            `;

        } catch (error) {
            console.error("Erro:", error);
            container.innerHTML = `<h2 style="color: #d6b36a;">Erro: ${error.message}</h2>
            <a href="Builds.html" class="btn-view">Voltar</a>`;
        }
    }

    window.addEventListener('DOMContentLoaded', carregarDetalhes);
    </script>
</body>
</html>