async function carregarDetalhes() {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');
        const container = document.getElementById('build-info');

        if (!container || !id) {
            if (container) container.innerHTML = "<h2>Build não identificada.</h2>";
            return;
        }

        try {
            const URL_RAILWAY = "https://elden-production.up.railway.app"; 
            const apiBaseUrl = window.location.hostname === 'localhost' 
                ? 'http://localhost:3000' 
                : URL_RAILWAY;

            const response = await fetch(`${apiBaseUrl}/api/builds/${id}`);
            if (!response.ok) throw new Error('Build não encontrada');
            
            const build = await response.json();

            // --- LÓGICA DE VÍDEO (MP4, YOUTUBE + TIKTOK) ---
            let videoHtml = "";
            if (build.video_url) {
                const url = build.video_url.trim().toLowerCase();
                let urlFinal = build.video_url.trim();

                // 1. Verificar se é vídeo baixado (MP4) e corrigir caminho se necessário
                if (url.endsWith('.mp4')) {
                    // Se o arquivo estiver em /video e o html em /index, precisamos do ../
                    if (!url.startsWith('http') && !url.startsWith('../')) {
                        urlFinal = '../' + urlFinal;
                    }
                    videoHtml = `<video src="${urlFinal}" autoplay muted loop controls playsinline 
                                 class="video-adaptativo">
                                 </video>`;
                } 
                // 2. Verificar se é TikTok
                else if (url.includes('tiktok.com')) {
                    const tiktokId = urlFinal.split('/video/')[1]?.split('?')[0];
                    if (tiktokId) {
                        videoHtml = `<iframe src="https://www.tiktok.com/embed/v2/${tiktokId}" 
                                     class="iframe-adaptativo" style="background: transparent !important;"
                                     frameborder="0" allowtransparency="true" allowfullscreen></iframe>`;
                    }
                } 
                // 3. Verificar se é YouTube
                else {
                    let videoId = "";
                    if (url.includes('shorts/')) {
                        videoId = urlFinal.split('shorts/')[1].split(/[?&]/)[0];
                    } else if (url.includes('v=')) {
                        videoId = urlFinal.split('v=')[1].split('&')[0];
                    } else if (url.includes('youtu.be/')) {
                        videoId = urlFinal.split('youtu.be/')[1].split(/[?&]/)[0];
                    }
                    if (videoId) {
                        videoHtml = `<iframe src="https://www.youtube.com/embed/${videoId.trim()}" 
                                     class="iframe-adaptativo" frameborder="0" allowfullscreen></iframe>`;
                    }
                }
            }

            if (!videoHtml) {
                videoHtml = `<div class="video-placeholder">
                                <p>Vídeo de demonstração em breve...</p>
                                <small>Link: ${build.video_url || 'vazio'}</small>
                             </div>`;
            }

            // --- INJEÇÃO DO HTML (Mantendo sua estrutura original) ---
            container.innerHTML = `
                <div class="build-flex-container">
                    <div class="build-texto">
                        <h1>${build.nome || 'Nome da Build'}</h1>
                        <p style="color: #ffffff; font-style: italic; opacity: 0.9;">${build.descricao || 'Sem descrição'}</p>
                        
                        <h3 style="margin-top:30px;">ESTATUTOS (STATS)</h3>
                        <div class="grid-stats">
                            <div class="stat-item">VIGOR: ${build.vigor || 0}</div>
                            <div class="stat-item">MENTE: ${build.mente || 0}</div>
                            <div class="stat-item">RESISTÊNCIA: ${build.resistencia || 0}</div>
                            <div class="stat-item">FORÇA: ${build.forca || 0}</div>
                            <div class="stat-item">DESTREZA: ${build.destreza || 0}</div>
                            <div class="stat-item">INTELIGÊNCIA: ${build.inteligencia || 0}</div>
                            <div class="stat-item">FÉ: ${build.fe || 0}</div>
                            <div class="stat-item">ARCANO: ${build.arcano || 0}</div>
                        </div>

                        <div class="equipamentos">
                            <h3>EQUIPAMENTOS E LOCALIZAÇÃO</h3>
                            <p><strong>Arma Principal:</strong> ${build.arma_principal || 'Não informada'}</p>
                            <p><strong>Classe Inicial Sugerida:</strong> ${build.classe_inicial || 'Qualquer uma'}</p>
                            <p><strong>Onde encontrar:</strong> ${build.localizacao_nome || 'Explorando o mapa'}</p>
                            ${build.localizacao_url ? `<a href="${build.localizacao_url}" target="_blank" style="color: #d6b36a; font-weight: bold;">[Abrir Mapa em Nova Aba]</a>` : ''}
                        </div>

                        <div style="margin-top: 40px;">
                            <a href="Builds.html" class="btn-view">← Voltar para lista</a>
                        </div>
                    </div>

                    <div class="coluna-midia-mapa">
                        <div class="build-video">
                            ${videoHtml}
                        </div>
                        <div class="build-mapa">
                             ${build.localizacao_url ? 
                                `<iframe src="${build.localizacao_url}" frameborder="0" allowfullscreen></iframe>` :
                                `<div class="video-placeholder"><p>Mapa disponível em breve...</p></div>`
                             }
                        </div>
                    </div>
                </div>
            `;
        } catch (error) {
            console.error("Erro:", error);
            container.innerHTML = `<h2 style="color: #d6b36a;">Erro: ${error.message}</h2>
            <a href="Builds.html" class="btn-view">Voltar</a>`;
        }
    }